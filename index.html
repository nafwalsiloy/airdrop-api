<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airdrop Claim</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #status {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Airdrop Claim</h1>
    <button id="connectButton">Connect Wallet (MetaMask or WalletConnect)</button>
    <button id="checkEligibilityButton" disabled>Check Eligibility</button>
    <button id="claimButton" disabled>Claim Airdrop</button>
    <p id="status"></p>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.6.6/dist/umd/index.min.js"></script>
    <script>
        let provider;
        let signer;
        let userAddress;
        let eligibility = false;
        let value;
        let proof;
        
        const connectButton = document.getElementById('connectButton');
        const checkEligibilityButton = document.getElementById('checkEligibilityButton');
        const claimButton = document.getElementById('claimButton');
        const status = document.getElementById('status');
        
        // Function to detect and handle wallet connection
        async function connectWallet() {
            if (window.ethereum) {
                // MetaMask connection
                provider = new ethers.Web3Provider(window.ethereum);
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    if (accounts && accounts.length > 0) {
                        userAddress = accounts[0];
                        signer = provider.getSigner();
                        status.textContent = `MetaMask connected: ${userAddress}`;
                        checkEligibilityButton.disabled = false;
                    }
                } catch (error) {
                    console.error(error);
                    status.textContent = "MetaMask connection failed.";
                }
            } else if (window.WalletConnectProvider) {
                // WalletConnect connection
                const walletConnectProvider = new WalletConnectProvider({
                    infuraId: "838cd6b58d214e2b9578592c0f2344a9" // You need to replace this with your Infura Project ID
                });
                
                try {
                    await walletConnectProvider.enable();
                    provider = new ethers.Web3Provider(walletConnectProvider);
                    signer = provider.getSigner();
                    userAddress = await signer.getAddress();
                    status.textContent = `WalletConnect connected: ${userAddress}`;
                    checkEligibilityButton.disabled = false;

                    // Listen for account and network changes
                    walletConnectProvider.on("accountsChanged", (accounts) => {
                        userAddress = accounts[0];
                        status.textContent = `Wallet changed: ${userAddress}`;
                    });

                    walletConnectProvider.on("chainChanged", (chainId) => {
                        status.textContent = `Network changed: ${chainId}`;
                        window.location.reload();
                    });
                } catch (error) {
                    console.error(error);
                    status.textContent = "WalletConnect connection failed.";
                }
            } else {
                status.textContent = "Please install MetaMask or another Ethereum wallet.";
            }
        }

        connectButton.addEventListener('click', connectWallet);

        // Check eligibility via API
        checkEligibilityButton.addEventListener('click', async () => {
            status.textContent = "Checking eligibility...";
            try {
                // Replace this with your real API endpoint
                const response = await fetch(`https://airdrop-api.vercel.app/eligibility?address=${userAddress}`);
                const data = await response.json();

                if (data.eligible) {
                    eligibility = true;
                    value = data.value;  // The value to claim
                    proof = data.proof;  // Proof (if needed)
                    claimButton.disabled = false;
                    status.textContent = `You are eligible for an airdrop of ${value} tokens!`;
                } else {
                    eligibility = false;
                    status.textContent = "You are not eligible for the airdrop.";
                }
            } catch (error) {
                status.textContent = "Error checking eligibility.";
                console.error(error);
            }
        });

        // Claim the airdrop
        claimButton.addEventListener('click', async () => {
            if (!eligibility) {
                status.textContent = "You are not eligible for the airdrop.";
                return;
            }

            status.textContent = "Claiming airdrop...";
            try {
                // Replace this with your real contract address and ABI
                const contractAddress = "YOUR_CONTRACT_ADDRESS";
                const contractABI = [
                    "function claim(address recipient, uint256 value, bytes32[] calldata proof) external"
                ];

                const contract = new ethers.Contract(contractAddress, contractABI, signer);
                const tx = await contract.claim(userAddress, value, proof);
                await tx.wait();

                status.textContent = "Airdrop claimed successfully!";
            } catch (error) {
                status.textContent = "Error claiming airdrop.";
                console.error(error);
            }
        });
    </script>
</body>
</html>
